<img src="https://r2cdn.perplexity.ai/pplx-full-logo-primary-dark%402x.png" style="height:64px;margin-right:32px"/>

# Промт для Cursor: рефакторинг вкладки «Календарь» с сущностью Events

Ты — ведущий full‑stack разработчик (TypeScript, React + Vite, TailwindCSS, TanStack Query, Express, Drizzle/PostgreSQL). Задача: рефакторинг вкладки «Календарь» и внедрение новой сущности событий (events) с UI формы создания/редактирования по прикреплённым скриншотам, но на русском и с нашей цветовой схемой.

Контекст и требования:

- Стек фронтенда: React 18, TypeScript, TailwindCSS, Radix UI (если уместно), TanStack Query.
- Бэкенд: Express + TypeScript, Drizzle ORM (PostgreSQL), уже есть таблица events.
- Таблица events (готовая):
CREATE TABLE IF NOT EXISTS events (
id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
title VARCHAR(255) NOT NULL,
description TEXT,
start_time TIMESTAMP NOT NULL,
end_time TIMESTAMP NOT NULL,
location VARCHAR(255),
is_all_day BOOLEAN DEFAULT FALSE,
created_at TIMESTAMP DEFAULT NOW() NOT NULL,
updated_at TIMESTAMP DEFAULT NOW() NOT NULL
);
- Локализация: весь UI на русском.
- Цвета интерфейса (используй как design tokens, Tailwind custom theme):
background: \#F7F4EF
card: \#E3DBCF
accent: \#B9A989
text: \#857A64
white: \#FFFFFF
- UX: форма должна соответствовать скриншотам (поля, тумблеры, отступы, радиусы), адаптивна для мобильного, доступность (aria-метки), моментальный визуальный отклик при изменении тумблеров.
- Оптимистичные обновления при создании/редактировании/удалении через TanStack Query: onMutate — мгновенный апдейт, onSettled — invalidate(['events'], exact:false).
- Таймзона: использовать системную по умолчанию, но поле «Часовой пояс» редактируемое; даты/время — локальные для пользователя, правильно сериализовать в UTC для БД.
- Валидировать ввод Zod-схемой на фронте; на бэкенде — повторная валидация.
- Поддержать all‑day событие: если is_all_day=true, скрыть выбор времени, хранить start_time как начало дня 00:00:00, end_time как конец дня 23:59:59 локали пользователя (перед записью конвертировать в UTC).
- Поле Location: переключатель «Онлайн‑событие» (как на скрине) — при включении прятать поле адреса и сохранять location="online" (или ссылку, если введена).
- Кнопка «Создать событие» / «Сохранить изменения». Кнопка disabled, если форма невалидна.
- Уведомления (toast) об успехе/ошибке.
- Повторение (Repeat) сейчас выключено — добавить тумблер и placeholder UI, но без серверной логики (подготовить типы на будущее).

Что нужно сделать по шагам (сгенерируй код и файлы):

1) Доменная модель и типы

- Создай shared типы Event, EventInput, EventUpdate.
- Zod‑схема для фронта: title (1..255), description (опц.), date/time обязательны, end_time > start_time, is_all_day bool, location опц., timezone строка IANA (по умолчанию из Intl.DateTimeFormat().resolvedOptions().timeZone).

2) Бэкенд API (Express + Drizzle)

- Эндпоинты:
GET /api/events?from=ISO\&to=ISO — список событий пользователя в диапазоне.
POST /api/events — создать.
PATCH /api/events/:id — обновить.
DELETE /api/events/:id — удалить.
- Авторизация: пользователь определяется по текущей сессии/JWT (используй существующий механизм users). Ограничить выборку по user_id.
- Транзакция для create/update; updated_at обновлять автоматически.
- Нормализуй время: принимать ISO с таймзоной клиента, сохранять в UTC.

3) Клиентские хуки TanStack Query

- useEvents(range): ключ ['events', {from,to}], фетч списка.
- useCreateEvent, useUpdateEvent, useDeleteEvent с оптимистичными апдейтами:
    - onMutate: мгновенно меняй кэш по ключам диапазонов, куда попадает событие.
    - onError: откат.
    - onSettled: invalidate(['events']).

4) UI вкладки «Календарь»

- Страница Calendar:
    - Верхний бар с месяцем/неделей, переключатели вид: Месяц/Неделя/День.
    - Кнопка «Новое событие» — модалка формы.
    - Рендер событий в выбранном диапазоне.
- Компоненты:
    - EventForm (модалка) по скриншотам:
        - Заголовок: «Новое событие»
        - Поля: Название, Дата (all‑day тумблер), From/To (date+time pickers), Часовой пояс (селект, предзаполнен), Повтор (тумблер, disabled placeholder), Локация (тумблер «Онлайн‑событие» + поле адреса), Напоминание (селект: 10 минут до, 30 минут и т.д. — пока только UI).
        - Текстовая область «Заметки» (опц.).
        - Кнопки: «Создать событие» / «Сохранить».
    - EventItem: карточка события с цветовым акцентом accent, поддержка long‑press для редактирования в мобильной версии.
- Стили Tailwind: используй указанные цвета, плавные hover/focus, радиусы как на скринах, тумблеры круглые, приятные для клика.

5) Локализация и форматирование дат

- dayjs/date-fns с русской локалью: названия месяцев/дней на русском.
- Формат: 13/08/2025 05:44 PM → использовать 24‑часовой формат для RU (настройка по умолчанию), но оставить возможность 12/24 в настройках позже.

6) Тестирование и UX‑детали

- Покрыть критические ветви: создание all‑day, редактирование времени, удаление.
- Обработать пограничные случаи: end_time раньше start_time, пересечение суток, перевод времени при смене таймзоны.
- Лоадер на сабмите, блокировка повторных кликов.
- Дебаунс при перемещении диапазона календаря (fetch не чаще 1р/300мс).

Ожидаемый результат:

- Полный набор изменений (файлы фронта и бэка), миграции/seed не требуются (таблица events уже есть).
- Готовый UI формы «Новое событие»/«Редактировать событие» в стиле скриншотов, но на русском и с нашими цветами.
- Мгновенная визуальная реакция тумблеров и обновления списка через оптимистичные апдейты.
- Докблоки к публичным функциям и хукам.
- Инструкции: как запустить и где проверить (роут страницы, пример curl для API).

Сгенерируй:

- Исходники компонентов и хуков (TSX/TS).
- Маршруты Express и Drizzle‑репозиторий.
- Tailwind theme override с нашими цветами.
- Краткий README к этому изменению (как протестировать сценарии).

<div style="text-align: center">⁂</div>

[^1]: image.jpg

[^2]: image.jpg

