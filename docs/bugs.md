### Баг полей дат на разных устройствах (iOS Safari)

Симптомы:
- Нативные поля `date`, `time`, `datetime-local` визуально «выползают» за контейнер на iOS (iPhone 13 Pro Max), правые углы обрезаются.
- При разных устройствах или региональных настройках элемент мог растягиваться или терять скругление.

Причина:
- Нативные iOS-контролы — «replaced elements», их рендеринг игнорирует часть CSS-ограничений контейнера.
- Собственная рамка/фон инпута конфликтуют с размерами сетки и скруглениями.

Решение (без заливки полей):
1) Оборачиваем нативный input во внутренний контейнер-клиппер, который рисует рамку и скругление:
   - Классы: `overflow-hidden rounded-md border border-border bg-background`.
2) Сам input делаем прозрачным и без собственной рамки:
   - Классы: `border-0 bg-transparent w-full min-w-0 focus:ring-accent` и `style={{ fontSize: 16 }}` (чтобы избежать авто-зумирования на iOS).
3) Применяем `useFitToContainer` к контейнеру-клипперу, чтобы iOS корректно вписывал нативный контрол внутрь размеров родителя.

Где применено:
- `client/src/components/EventDialog.tsx` — поля даты и времени.
- `client/src/components/tasks/TaskForm.tsx` — поле срока.

Эффект:
- Рамка и скругления стабильны на всех устройствах.
- Поля больше не выступают за контейнер и не обрезаются, даже без фоновой заливки у самого инпута.

### Несостыковка оси X (Пн–Вс) и точек на графиках Reflect

Симптомы:
- При выборе дня недели график смещался, но подписи оси X оставались прежними, в результате точки не совпадали с подписями.
- «Сегодня» мог оказываться не крайним правым значением, а ось начиналась не с корректного дня (например, справа была «Ср» вместо «Чт» при выборе четверга).

Причины:
- Использование `toISOString()` и парсинга ISO (`new Date('YYYY-MM-DD')`) приводило к сдвигам из‑за часового пояса.
- Подписи X строились не из того же массива дат, что и значения графика, из-за чего возникал рассинхрон.

Решение:
1) Полный отказ от ISO-парсинга для локальных календарных дат. Все вычисления недели ведутся из локальных компонент `yyyy, mm, dd`:
   - Диапазон 7 дней — строго локально: последняя точка = выбранная дата; 6 предыдущих — ретроспектива.
   - Мини‑календарь и навигация — только локальные строки `YYYY-MM-DD` без `toISOString()`.
2) Подписи оси X генерируются из тех же 7 локальных дат массива `filledRange`, чтобы гарантировать совпадение.
3) Индекс выбранного дня на графике всегда крайний правый.

Где изменено:
- `client/src/pages/wellbeing.tsx`: вычисление `rangeFrom/rangeTo`, `filledRange`, X‑labels из `filledRange`; мини‑календарь на локальных датах; выбранный день — крайняя правая точка.

Эффект:
- Подписи оси X и точки совпадают; правый лейбл — weekday выбранной даты; поведение календаря предсказуемо.

### Линия графика не отображалась (видны только черные точки)

Симптомы:
- На графиках Reflect показывались только точки, линия отсутствовала.
- Точки иногда были черными, а не в цвете акцента.

Причины:
- Неправильное использование CSS‑переменных в SVG: использовалось `hsl(var(--accent))`, при этом корень был задан как `::root`, из‑за чего переменные не применялись внутри SVG корректно.
- На «текущей» точке был override цвета в черный, что визуально конфликтовало со стилем.

Решение:
1) Исправили селектор на `:root` в `client/src/index.css`.
2) В `ReflectLineChart` заменили все `hsl(var(--...))` на `var(--...)` для свойств `stroke`/`fill` SVG.
3) Убрали черный override для «сегодня»: все точки и линия теперь в акцентном цвете.
4) Добавили горизонтальную базовую линию для нуля и убрали вертикальную ось слева (сохранили только сетку и подписи), чтобы график выглядел чище.

Эффект:
- Линия отображается и соединяет те же точки, что видит пользователь; точки и линия окрашены в фирменный акцентный цвет.

### Задержка при переключении статуса задач (completed) — заметна пользователю

Симптомы:
- При переключении чекбокса задача зачеркивалась только после ответа сервера (видно по сетевым событиям в DevTools), что создаёт ощущение лагов.

Причины:
- Optimistic updates были реализованы с предположением, что кэш `useTasks` — массив задач. Фактически хук возвращал объект `{ data: [...] }` (ответ API-обёртка), из‑за чего мгновенного обновления UI не происходило.

Решение:
1) В `client/src/lib/hooks.ts` обновили optimistic updates в хукаx `useCreateTask`, `useUpdateTask`, `useToggleTask`, `useDeleteTask`, чтобы изменять кэш вида `{ data: [...] }` через `setQueryData(old => ({ ...old, data: next }))`.
2) Для toggle также обновляем `updated_at` локально, а затем выполняется фоновая синхронизация и инвалидация.

Эффект:
- Чекбокс и зачёркивание обновляются моментально для пользователя; сетевой запрос завершается уже «за кулисами».


